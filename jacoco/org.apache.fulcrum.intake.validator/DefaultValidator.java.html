<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DefaultValidator.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Fulcrum Intake Service</a> &gt; <a href="index.source.html" class="el_package">org.apache.fulcrum.intake.validator</a> &gt; <span class="el_source">DefaultValidator.java</span></div><h1>DefaultValidator.java</h1><pre class="source lang-java linenums">package org.apache.fulcrum.intake.validator;

/*
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * &quot;License&quot;); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */

import java.util.Map;

import org.apache.avalon.framework.logger.LogEnabled;
import org.apache.avalon.framework.logger.Logger;
import org.apache.commons.lang3.StringUtils;
import org.apache.fulcrum.intake.model.Field;

/**
 * DefaultValidator that will compare a testValue against the following
 * constraints:
 *
 * &lt;table&gt;
 * &lt;caption&gt;Validation rules&lt;/caption&gt;
 * &lt;tr&gt;&lt;th&gt;Name&lt;/th&gt;&lt;th&gt;Valid Values&lt;/th&gt;&lt;th&gt;Default Value&lt;/th&gt;&lt;/tr&gt;
 * &lt;tr&gt;&lt;td&gt;required&lt;/td&gt;&lt;td&gt;true|false&lt;/td&gt;&lt;td&gt;false&lt;/td&gt;&lt;/tr&gt;
 * &lt;tr&gt;&lt;td&gt;mask&lt;/td&gt;&lt;td&gt;regexp&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;
 * &lt;tr&gt;&lt;td&gt;minLength&lt;/td&gt;&lt;td&gt;integer&lt;/td&gt;&lt;td&gt;0&lt;/td&gt;&lt;/tr&gt;
 * &lt;tr&gt;&lt;td&gt;maxLength&lt;/td&gt;&lt;td&gt;integer&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;
 * &lt;/table&gt;
 *
 * This validator can serve as the base class for more specific validators
 *
 * @author &lt;a href=&quot;mailto:jmcnally@collab.net&quot;&gt;John McNally&lt;/a&gt;
 * @author &lt;a href=&quot;mailto:quintonm@bellsouth.net&quot;&gt;Quinton McCombs&lt;/a&gt;
 * @author &lt;a href=&quot;mailto:Colin.Chalmers@maxware.nl&quot;&gt;Colin Chalmers&lt;/a&gt;
 * @author &lt;a href=&quot;mailto:tv@apache.org&quot;&gt;Thomas Vandahl&lt;/a&gt;
 * @version $Id$
 */
abstract public class DefaultValidator&lt;T&gt;
        implements Validator&lt;T&gt;, InitableByConstraintMap, LogEnabled
{
    /** A boolean value to signify if the field is definitely required or not */
<span class="fc" id="L54">    protected boolean required = false;</span>

    /** The message to show if field fails required test */
<span class="fc" id="L57">    protected String requiredMessage = null;</span>

    /** The minimum length of the field */
<span class="fc" id="L60">    protected int minLength = 0;</span>

    /** The message to show if field fails min-length test */
<span class="fc" id="L63">    protected String minLengthMessage = null;</span>

    /** The maximum length of the field */
<span class="fc" id="L66">    protected int maxLength = 0;</span>

    /** The message to show if field fails max-length test */
<span class="fc" id="L69">    protected String maxLengthMessage = null;</span>

    /** Error message pertaining to Rule that was broken */
<span class="fc" id="L72">    protected String errorMessage = null;</span>

    /** Logging */
    protected Logger log;

    /**
     * Default constructor
     */
    public DefaultValidator()
<span class="fc" id="L81">    {</span>
        //
<span class="fc" id="L83">    }</span>

    /**
	 * Enable Avalon Logging
	 */
	@Override
	public void enableLogging(Logger logger)
	{
<span class="fc" id="L91">		this.log = logger.getChildLogger(getClass().getSimpleName());</span>
<span class="fc" id="L92">	}</span>

    /**
     * Extract the relevant parameters from the constraints listed
     * in &amp;lt;rule&amp;gt; tags within the intake.xml file.
     *
     * @param paramMap a &lt;code&gt;Map&lt;/code&gt; of &lt;code&gt;Rule&lt;/code&gt;'s
     * containing constraints on the input.
     * @throws InvalidMaskException An invalid mask was specified for one of the rules
     */
    @Override
	public void init(Map&lt;String, ? extends Constraint&gt; paramMap)
            throws InvalidMaskException
    {
<span class="fc" id="L106">        Constraint constraint = paramMap.get(REQUIRED_RULE_NAME);</span>
<span class="fc bfc" id="L107" title="All 2 branches covered.">        if (constraint != null)</span>
        {
<span class="fc" id="L109">            String param = constraint.getValue();</span>
<span class="fc" id="L110">            required = Boolean.valueOf(param).booleanValue();</span>
<span class="fc" id="L111">            requiredMessage = constraint.getMessage();</span>
        }

<span class="fc" id="L114">        constraint = paramMap.get(MIN_LENGTH_RULE_NAME);</span>
<span class="fc bfc" id="L115" title="All 2 branches covered.">        if (constraint != null)</span>
        {
<span class="fc" id="L117">            String param = constraint.getValue();</span>
<span class="fc" id="L118">            minLength = Integer.parseInt(param);</span>
<span class="fc" id="L119">            minLengthMessage = constraint.getMessage();</span>
        }

<span class="fc" id="L122">        constraint = paramMap.get(MAX_LENGTH_RULE_NAME);</span>
<span class="fc bfc" id="L123" title="All 2 branches covered.">        if (constraint != null)</span>
        {
<span class="fc" id="L125">            String param = constraint.getValue();</span>
<span class="fc" id="L126">            maxLength = Integer.parseInt(param);</span>
<span class="fc" id="L127">            maxLengthMessage = constraint.getMessage();</span>
        }
<span class="fc" id="L129">    }</span>

    /**
     * Determine whether a field meets the criteria specified
     * in the constraints defined for this validator
     *
     * @param field a &lt;code&gt;Field&lt;/code&gt; to be tested
     * @return true if valid, false otherwise
     */
    @Override
	public boolean isValid(Field&lt;T&gt; field)
    {
<span class="nc" id="L141">        boolean valid = false;</span>
        try
        {
<span class="nc" id="L144">            assertValidity(field);</span>
<span class="nc" id="L145">            valid = true;</span>
        }
<span class="nc" id="L147">        catch (ValidationException ve)</span>
        {
<span class="nc" id="L149">            valid = false;</span>
<span class="nc" id="L150">        }</span>
<span class="nc" id="L151">        return valid;</span>
    }

    /**
     * Determine whether a field meets the criteria specified
     * in the constraints defined for this validator
     *
     * @param field a &lt;code&gt;Field&lt;/code&gt; to be tested
     * @throws ValidationException containing an error message if the
     * testValue did not pass the validation tests.
     */
    @Override
	public void assertValidity(Field&lt;T&gt; field)
            throws ValidationException
    {
<span class="pc bpc" id="L166" title="1 of 2 branches missed.">    	if (field.isMultiValued())</span>
    	{
<span class="nc" id="L168">    		String[] stringValues = (String[])field.getTestValue();</span>

<span class="nc bnc" id="L170" title="All 2 branches missed.">    		for (int i = 0; i &lt; stringValues.length; i++)</span>
    		{
<span class="nc" id="L172">    			assertValidity(stringValues[i]);</span>
    		}
<span class="nc" id="L174">    	}</span>
    	else
    	{
<span class="fc" id="L177">    		assertValidity((String)field.getTestValue());</span>
    	}
<span class="fc" id="L179">    }</span>

    /**
     * Determine whether a testValue meets the criteria specified
     * in the constraints defined for this validator
     *
     * @param testValue a &lt;code&gt;String&lt;/code&gt; to be tested
     * @return true if valid, false otherwise
     *
     * @deprecated use isValid(Field) instead
     */
    @Deprecated
    @Override
	public boolean isValid(String testValue)
    {
<span class="nc" id="L194">        boolean valid = false;</span>
        try
        {
<span class="nc" id="L197">            assertValidity(testValue);</span>
<span class="nc" id="L198">            valid = true;</span>
        }
<span class="nc" id="L200">        catch (ValidationException ve)</span>
        {
<span class="nc" id="L202">            valid = false;</span>
<span class="nc" id="L203">        }</span>
<span class="nc" id="L204">        return valid;</span>
    }

    /**
     * Determine whether a testValue meets the criteria specified
     * in the constraints defined for this validator
     *
     * @param testValue a &lt;code&gt;String&lt;/code&gt; to be tested
     * @throws ValidationException containing an error message if the
     * testValue did not pass the validation tests.
     */
    @Override
	public void assertValidity(String testValue)
            throws ValidationException
    {
<span class="pc bpc" id="L219" title="1 of 4 branches missed.">        if (!required &amp;&amp; StringUtils.isEmpty(testValue))</span>
        {
<span class="nc" id="L221">            return;</span>
        }
<span class="fc bfc" id="L223" title="All 4 branches covered.">        if (required &amp;&amp; StringUtils.isEmpty(testValue))</span>
        {
<span class="fc" id="L225">            errorMessage = requiredMessage;</span>
<span class="fc" id="L226">            throw new ValidationException(requiredMessage);</span>
        }

<span class="fc bfc" id="L229" title="All 4 branches covered.">        if (minLength &gt; 0 &amp;&amp; testValue.length() &lt; minLength)</span>
        {
<span class="fc" id="L231">            errorMessage = minLengthMessage;</span>
<span class="fc" id="L232">            throw new ValidationException(minLengthMessage);</span>
        }
<span class="fc bfc" id="L234" title="All 4 branches covered.">        if (maxLength &gt; 0 &amp;&amp; testValue.length() &gt; maxLength)</span>
        {
<span class="fc" id="L236">            errorMessage = maxLengthMessage;</span>
<span class="fc" id="L237">            throw new ValidationException(maxLengthMessage);</span>
        }
<span class="fc" id="L239">    }</span>


    /**
     * Get the error message resulting from invalid input.
     *
     * @return a &lt;code&gt;String&lt;/code&gt; message, or the empty String &quot;&quot;.
     */
    @Override
	public String getMessage()
    {
<span class="nc" id="L250">        String retValue = &quot;&quot;;</span>

<span class="nc bnc" id="L252" title="All 2 branches missed.">        if(errorMessage != null)</span>
        {
<span class="nc" id="L254">            retValue = errorMessage;</span>
        }

<span class="nc" id="L257">        return retValue;</span>
    }

    // ************************************************************
    // **                Bean accessor methods                   **
    // ************************************************************

    /**
     * Get the value of required.
     *
     * @return value of required.
     */
    public boolean isRequired()
    {
<span class="nc" id="L271">        return required;</span>
    }

    /**
     * Set the value of required.
     *
     * @param required  Value to assign to required.
     */
    public void setRequired(boolean required)
    {
<span class="nc" id="L281">        this.required = required;</span>
<span class="nc" id="L282">    }</span>

    /**
     * Get the value of requiredMessage.
     *
     * @return value of requiredMessage.
     */
    public String getRequiredMessage()
    {
<span class="nc" id="L291">        return requiredMessage;</span>
    }

    /**
     * Set the value of requiredMessage.
     *
     * @param requiredMessage  Value to assign to requiredMessage.
     */
    public void setRequiredMessage(String requiredMessage)
    {
<span class="nc" id="L301">        this.requiredMessage = requiredMessage;</span>
<span class="nc" id="L302">    }</span>

    /**
     * Get the value of minLength.
     *
     * @return value of minLength.
     */
    public int getMinLength()
    {
<span class="nc" id="L311">        return minLength;</span>
    }

    /**
     * Set the value of minLength.
     *
     * @param minLength  Value to assign to minLength.
     */
    public void setMinLength(int minLength)
    {
<span class="nc" id="L321">        this.minLength = minLength;</span>
<span class="nc" id="L322">    }</span>

    /**
     * Get the value of minLengthMessage.
     *
     * @return value of minLengthMessage.
     */
    public String getMinLengthMessage()
    {
<span class="nc" id="L331">        return minLengthMessage;</span>
    }

    /**
     * Set the value of minLengthMessage.
     *
     * @param minLengthMessage  Value to assign to minLengthMessage.
     */
    public void setMinLengthMessage(String minLengthMessage)
    {
<span class="nc" id="L341">        this.minLengthMessage = minLengthMessage;</span>
<span class="nc" id="L342">    }</span>

    /**
     * Get the value of maxLength.
     *
     * @return value of maxLength.
     */
    public int getMaxLength()
    {
<span class="nc" id="L351">        return maxLength;</span>
    }

    /**
     * Set the value of maxLength.
     *
     * @param maxLength  Value to assign to maxLength.
     */
    public void setMaxLength(int maxLength)
    {
<span class="nc" id="L361">        this.maxLength = maxLength;</span>
<span class="nc" id="L362">    }</span>

    /**
     * Get the value of maxLengthMessage.
     *
     * @return value of maxLengthMessage.
     */
    public String getMaxLengthMessage()
    {
<span class="nc" id="L371">        return maxLengthMessage;</span>
    }

    /**
     * Set the value of maxLengthMessage.
     *
     * @param maxLengthMessage  Value to assign to maxLengthMessage.
     */
    public void setMaxLengthMessage(String maxLengthMessage)
    {
<span class="nc" id="L381">        this.maxLengthMessage = maxLengthMessage;</span>
<span class="nc" id="L382">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>